# RecNumbers — Распознавание автомобильных номеров РФ

Программа на Python для автоматического распознавания автомобильных номеров формата РФ с использованием веб-камеры или видео.  
В основе: **YOLOv8** (детектор табличек) + **PaddleOCR** (распознавание текста) + система стабилизации, кулдаун и сохранение истории в CSV.

---

## Возможности
- Поддержка **вебкамеры или видеофайла** (`VIDEO_SOURCE`).
- **Детекция номеров** с помощью YOLOv8.
- **Распознавание текста** PaddleOCR (с угловым классификатором).
- **Выравнивание перспективы** (исправление угла таблички).
- Предобработка ROI (контрастирование, бинаризация).
- Проверка формата РФ (ГОСТ).
- Стабилизация OCR (несколько подтверждений подряд или по времени).
- Кулдаун между повторными фиксациями одного номера.
- Ведение истории в CSV: `plate_text, first_seen, detections`.

---

## Установка

### 1. Склонировать проект
Сохрани `main.py` и файл весов YOLO (`best.pt`) в одну папку, например `RecNumbers`.

### 2. Создать виртуальное окружение
Рекомендуется использовать **Python 3.10** (так как PaddleOCR 2.x лучше сюда подходит).

Пример через `venv`:
```bash
cd RecNumbers
python3.10 -m venv .venv
.\.venv\Scripts\activate   # Windows
source .venv/bin/activate    # Linux/Mac
```

### 3. Установить зависимости
```bash
pip install ultralytics opencv-python numpy
pip install paddlepaddle==2.6.2 paddleocr==2.9.1
```

> ⚠️ Если у тебя Python 3.12+, то PaddleOCR 2.9.1 не поставится. Нужно либо:
> - использовать Python 3.10, либо
> - обновить код под PaddleOCR 3.x (см. документацию).

---

## Запуск

```bash
python main.py
```

- В окне будет показано видео с рамками вокруг номеров.  
- Распознанные номера будут подписаны на изображении.  
- Для выхода нажми `q`.

---

## Файлы

- `main.py` — основной код.  
- `best.pt` — веса YOLO (детектор номеров).  
- `plates.csv` — лог с номерами и временем фиксаций.

---

## Конфигурация

Все параметры задаются в начале `main.py`:

```python
VIDEO_SOURCE = 0            # источник видео (0 = вебкамера, "video.mp4" = файл)
YOLO_WEIGHTS = "best.pt"    # путь к весам YOLOv8

CSV_PATH   = "plates.csv"   # путь к CSV
DET_CONF = 0.20             # порог детектора YOLO
N_RECENT = 5                # сколько последних времен хранить
COOLDOWN_SECONDS = 15       # пауза между повторными фиксациями

STABLE_WINDOW = 1.0         # окно стабилизации OCR (сек)
REPEAT_VOTES  = 2           # минимальное число одинаковых чтений подряд
MIN_OCR_CONF  = 0.50        # минимальный OCR confidence
GRID          = 40          # квантование центра bbox для ключа

# Флаги отладки
DEBUG = True
RECTIFY_ENABLED = True
SHOW_RAW_OCR = True
SHOW_REASONS = True
```

---

## Формат CSV

Пример (`plates.csv`):

```csv
plate_text,first_seen,detections
A123BC77,2025-09-25T12:30:15,2025-09-25T12:30:15|2025-09-25T12:30:35
M456OP97,2025-09-25T13:01:05,2025-09-25T13:01:05
```

- `plate_text` — распознанный номер.  
- `first_seen` — время первого появления.  
- `detections` — история последних фиксаций (через `|`).

---

## Отладка
- `YOLO boxes: N` — количество боксов на кадре.  
- `OCR empty` — OCR ничего не прочитал.  
- `low conf` — слишком низкая уверенность OCR.  
- `regex fail` — текст не соответствует формату РФ.  
- В углу можно вывести «сырые» OCR-кандидаты (для анализа).

---

## Лицензия
MIT — свободное использование и модификация.
